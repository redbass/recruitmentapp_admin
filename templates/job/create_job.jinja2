{% extends '_base.jinja2' %}

{% block body %}

    <div class="container-fluid">
        <div class="navbar navbar-light bg-light justify-content-between">
            <div class="container">
                <a class="navbar-brand" href="#">Create job</a>
            </div>
        </div>


        <form action="{{ url_for('create_job_post') }}" method="post">
            <div class="form-group">
                <label for="company_id">Company</label>
                <select class="form-control" id="company_id" name="company_id">
                    <option>... select a company</option>
                    {% for company in companies %}
                    <option value="{{ company._id }}">{{ company.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="name">Title</label>
                <input type="text" class="form-control" name="title">
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <input type="text" class="form-control" name="description">
            </div>

            <div class="row">
                <div class="col-5">
                    <div id="mapid" style="height: 300px"></div>
                </div>
                <div class="col-7">


                    <div class="form-group">
                        <label for="description" readonly>Latitude</label>
                        <input type="text" class="form-control" name="latitude" id="latitude">
                    </div>


                    <div class="form-group">
                        <label for="description" readonly>Longitude</label>
                        <input type="text" class="form-control" name="longitude" id="longitude">
                    </div>

                </div>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>

        </form>

    </div>

{% endblock body %}

{% block footer_scripts %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script>
    <script>
        function initmap() {
            // set up the map
            var map = new L.Map('mapid');

            // create the tile layer with correct attribution
            var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            var osmAttrib = 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors';
            var osm = new L.TileLayer(osmUrl, {minZoom: 8, maxZoom: 12, attribution: osmAttrib});

            // start the map in South-East England
            map.setView(new L.LatLng(55.952141, -3.189296), 9);
            map.addLayer(osm);

            return map
        }


        var mymap = initmap();


        var marker;

        function onMapClick(e) {

            if (marker == null) {
                marker = L.marker(e.latlng).addTo(mymap);
            }
            marker.setLatLng(e.latlng);

            document.getElementById('latitude').value = e.latlng.lat;
            document.getElementById('longitude').value = e.latlng.lng;
        };
        mymap.on('click', onMapClick);

    </script>

{% endblock %}