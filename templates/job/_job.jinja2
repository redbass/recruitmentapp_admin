{% extends '_base.jinja2' %}


{% block footer_scripts %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script>
    <script>

        function initmap() {
            // set up the map
            var map = new L.Map('mapid');

            // create the tile layer with correct attribution
            var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            var osmAttrib = 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors';
            var osm = new L.TileLayer(osmUrl, {minZoom: 8, maxZoom: 12, attribution: osmAttrib});

            // start the map in South-East England
            map.setView(new L.LatLng(55.952141, -3.189296), 9);
            map.addLayer(osm);

            return map
        }

        var marker;
        function createMarker(latlng) {
            if (marker == null) {
                marker = L.marker(latlng).addTo(mymap);
            }
            marker.setLatLng(latlng);
        }

        function onMapClick(e) {
            document.getElementById('latitude').value = e.latlng.lat;
            document.getElementById('longitude').value = e.latlng.lng;
            createMarker(e.latlng);
        }

        var mymap = initmap();
        mymap.on('click', onMapClick);

        var initalMarkerLatLng = {{ initial_market_latlng or None | tojson}};
        if (initalMarkerLatLng !== null){
            createMarker(initalMarkerLatLng)
        }

    </script>

{% endblock %}